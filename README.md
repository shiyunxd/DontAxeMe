You are free to copy paste any lines of code from this if you would like to add this to your own module.

credit: @flonja for making this work at all.